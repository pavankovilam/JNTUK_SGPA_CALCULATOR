# -*- coding: utf-8 -*-
"""FLASK_RESULTS.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1zldA8oM-iI6SwKo-BYwE5lfBNH51S6SK
"""

from ast import Return
import pandas as pd
from flask import Flask,request,render_template
import warnings
warnings.filterwarnings("ignore")
d=r'Results1.xlsx'
r=pd.read_excel(d)
df=pd.DataFrame(r)
'''htno=input("enter hall ticket number").upper()
a=r['HTNO'].values== htno
b=df[a]
c=df[a]
#b.index.name='Sl_NO.'
c.reset_index(drop=True, inplace=True)
c.index.name='Sl_NO.'
c.index=c.index+1
#c[['Subname','Grade','Credits','Internals']]
#b[['SUBNAME','GRADE','CREDITS']]
grade={'ABSENT':0,'COMPLE':10,10:10,'A+':10,'A':9,'B':8,'C':7,'D':6,'E':5,'F':0}
b.GRADE=[grade[item] for item in b.GRADE]
b=b.assign(GC=b.GRADE*b.CREDITS)
sgpa=b['GC'].sum()/b['CREDITS'].sum()
#print(b)
#print('Your SGPA is',sgpa.round(2))
disp=pd.DataFrame(c[['SUBNAME','INTERNALS','GRADE','CREDITS']])#c=df[b]
print(disp)
if 'F'in c.GRADE.values.tolist():
    print("STATUS:-FAIL")
else:
    print('STATUS:-PASS')
    print('SGPA::',sgpa.round(2))
    print('percentage:',(sgpa*10-7.5).round(1),'%')'''

app=Flask(__name__)
@app.route('/',methods=['GET','POST'])
def test():
    if request.method=='POST':
        form=request.form
        htno=(str(form['htno'])).upper()
        a=r['HTNO'].values==htno
        b=df[a]
        c=df[a]
        #b.index.name='Sl_NO.'
        c.reset_index(drop=True, inplace=True)
        c.index.name='Sl_NO.'
        c.index=c.index+1
#c[['Subname','Grade','Credits','Internals']]
#b[['SUBNAME','GRADE','CREDITS']]
        grade={'ABSENT':0,'COMPLE':10,10:10,'A+':10,'A':9,'B':8,'C':7,'D':6,'E':5,'F':0}
        b.GRADE=[grade[item] for item in b.GRADE]
        b=b.assign(GC=b.GRADE*b.CREDITS)
        sgpa=b['GC'].sum()/b['CREDITS'].sum()
        if 'F'in c.GRADE.values.tolist():
            hey='FAIL'
            per=''
            gpa=''
        else:
            hey='PASS'
            per=(sgpa*10-7.5).round(2)
            gpa=sgpa.round(2)
            
#print(b)
#print('Your SGPA is',sgpa.round(2))
        disp=c[['SUBNAME','GRADE','CREDITS','INTERNALS']].to_html()  
        return render_template('page.html',res=disp,status=hey,perc=per,SGPA=gpa,htno=htno)
    return render_template('page.html',res='enter hall ticket number' , status='')
'''if 'F'in c.GRADE.values.tolist():
            return render_template('page.html',status= "STATUS:-FAIL")
        else:
            return render_template('page.html',status='status :-pass',percentage=(sgpa*10-7.5).round(2),SGPA=sgpa.round(2))
            #return render_template('page.html',percentage=(sgpa*10-7.5).round(2),SGPA=sgpa.round(2))'''
    #return render_template('page.html',res='enter hall ticket number' , status='')
'''return 'STATUS:-PASS \nSGPA::',sgpa.round(2)
            return 'percentage:',(sgpa*10-7.5).round(2),'%')'''
if __name__=='__main__':
    app.run(debug=True)

#print(c[['Subname','Grade','Credits','Internals']])
